<div class="new-clusters-wrapper">
  <h1>Create Kubernetes Cluster</h1>

  <mat-horizontal-stepper [linear]="true" #stepper>

    <mat-step label="Name and Cloud Account">
      <div class="name-and-cloud-account">
        <mat-form-field>
          <input matInput type="text" [(ngModel)]="clusterName" placeholder="Cluster name" autofocus="">
        </mat-form-field>

        <mat-form-field>
          <mat-select placeholder="Choose a cloud account" [(value)]="selectedCloudAccount" (selectionChange)="selectCloudAccount($event.value)">
            <mat-option *ngFor="let account of availableCloudAccounts" [value]="account">{{ account.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="step-actions">
          <button mat-raised-button class="secondary">LOAD PROFILE</button>
          <button mat-raised-button class="secondary" matStepperNext>NEXT</button>
        </div>
      </div>
    </mat-step>

    <mat-step label="Cluster Configuration" [stepControl]="clusterConfig">
      <form [formGroup]="clusterConfig" class="cluster-config-form">
        <div class="input-group">

          <mat-form-field>
            <mat-select placeholder="K8s Version" formControlName="K8sVersion">
              <mat-option *ngFor="let k of clusterOptions.K8sVersions" [value]="k">{{ k }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Flannel Version" formControlName="flannelVersion">
              <mat-option *ngFor="let f of clusterOptions.flannelVersions" [value]="f">{{ f }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Helm Version" formControlName="helmVersion">
              <mat-option *ngFor="let h of clusterOptions.helmVersions" [value]="h">{{ h }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Docker Version" formControlName="dockerVersion">
              <mat-option *ngFor="let d of clusterOptions.dockerVersions" [value]="d">{{ d }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Ubuntu Version" formControlName="ubuntuVersion">
              <mat-option *ngFor="let u of clusterOptions.ubuntuVersions" [value]="u">{{ u }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="input-group">
          <mat-form-field>
            <mat-select placeholder="Network Type" formControlName="networkType">
              <mat-option *ngFor="let n of clusterOptions.networkTypes" [value]="n">{{ n }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <input matInput placeholder="cidr" type="text" formControlName="cidr">
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Operating System" formControlName="operatingSystem">
              <mat-option *ngFor="let os of clusterOptions.operatingSystems" [value]="os">{{ os }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Arch" formControlName="arch">
              <mat-option *ngFor="let a of clusterOptions.archs" [value]="a">{{ a }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="RBAC Enabled" formControlName="rbacEnabled">
              <mat-option *ngFor="let b of clusterOptions.rbacEnabled" [value]="b">{{ b }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </form>

      <div class="step-actions">
        <button mat-raised-button class="secondary" matStepperPrevious>BACK</button>
        <button mat-raised-button class="secondary" matStepperNext>NEXT</button>
      </div>
    </mat-step>

    <mat-step label="Provider Configuration" [stepControl]="providerConfig">
      <!-- digital ocean -->
      <ng-container *ngIf="selectedCloudAccount?.provider == 'digitalocean'">
        <form [formGroup]="providerConfig">
          <mat-form-field>
            <mat-select placeholder="Select a Region" formControlName="region" (selectionChange)="selectRegion($event.value)">
              <mat-option *ngFor="let r of availableRegions?.regions" [value]="r">{{ r.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </form>
      </ng-container>

      <div class="step-actions">
        <button mat-raised-button class="secondary" matStepperPrevious>BACK</button>
        <button mat-raised-button class="secondary" matStepperNext>NEXT</button>
      </div>
    </mat-step>

    <mat-step label="Machine Configuration" [stepControl]="machineConfig">
      <div class="machine-config-step">
        <!-- digital ocean machines -->
        <ng-container *ngIf="selectedCloudAccount?.provider == 'digitalocean'" >
          <div class="machine" *ngFor="let m of machines; let idx = index">
            <mat-form-field class="type">
              <mat-select placeholder="Machine Type (size)" id="m.machineType" [(value)]="m.machineType">
                <mat-option *ngFor="let type of availableMachineTypes" [value]="type">{{ type }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="role">
              <mat-select placeholder="Role" [(value)]="m.role" >
                <mat-option value="Master">Master</mat-option>
                <mat-option value="Node">Node</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="quantity">
              <input matInput type="number" min="1" placeholder="Q-ty" [(ngModel)]="m.qty">
            </mat-form-field>

            <div class="delete" (click)="deleteMachine(idx)"></div>
          </div>

          <div class="add-machines" (click)="addBlankMachine()">
            <div class="plus"></div>
            <span class="add-label">Add more machines</span>
          </div>
        </ng-container>
      </div>

      <div class="step-actions">
        <button mat-raised-button class="secondary" matStepperPrevious>BACK</button>
        <button mat-raised-button class="secondary" matStepperNext>NEXT</button>
      </div>
    </mat-step>

    <mat-step label="Review">
      <div class="review-wrapper">
        <h1>{{ clusterName }}</h1>
        <div class="cloud-account">
          <h3>CLOUD ACCOUNT</h3>
          <p>{{ selectedCloudAccount?.name }} ({{ selectedCloudAccount?.provider }})</p>
        </div>

        <div class="cluster">
          <h3>CLUSTER DETAILS</h3>
          <div>
            <p>K8s VERSION: {{ clusterConfig.value.K8sVersion }}</p>
            <p>FLANNEL VERSION: {{ clusterConfig.value.flannelVersion }}</p>
            <p>HELM VERSION: {{ clusterConfig.value.helmVersion }}</p>
            <p>DOCKER VERSION: {{ clusterConfig.value.dockerVersion }}</p>
            <p>UBUNTU VERSION: {{ clusterConfig.value.ubuntuVersion }}</p>
            <p>NETWORK TYPE: {{ clusterConfig.value.networkType }}</p>
            <p>CIDR: {{ clusterConfig.value.cidr }}</p>
            <p>OPERATING SYSTEM: {{ clusterConfig.value.operatingSystem }}</p>
            <p>ARCH: {{ clusterConfig.value.arch }}</p>
          </div>
        </div>

        <div class="provider">
          <h3>PROVIDER CONFIGURATION</h3>
          <div *ngIf="selectedCloudAccount?.provider == 'digitalocean'">
            <p>REGION: {{ providerConfig.value.region.name }}</p>
          </div>
        </div>

        <div class="machines">
          <h3>MACHINES</h3>
          <div>
            <div *ngFor="let m of machines">
              <p>{{ m.qty }} x {{ m.machineType }} ({{ m.role }})</p>
            </div>
          </div>
        </div>

        <div class="action-buttons-wrapper">
          <button mat-raised-button class="secondary" matStepperPrevious>BACK</button>
          <button mat-raised-button class="secondary">SAVE PROFILE</button>
          <button mat-raised-button color="primary" (click)="createCluster()">CREATE</button>
        </div>
      </div>
    </mat-step>

  </mat-horizontal-stepper>

</div>
